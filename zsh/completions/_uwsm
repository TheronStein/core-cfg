#compdef uwsm

# AUTOMATICALLY GENERATED by `shtab`


_uwsm_commands() {
  local _commands=(
    "app:Launches application as a scope or service in specific slice."
    "aux:Can only be called by systemd user manager, used in units Exec\*\= keys"
    "check:Performs a check, returns 0 if true, 1 if false."
    "finalize:For use inside compositor to export essential variables and complete compositor unit startup."
    "select:Invokes whiptail menu for selecting wayland-sessions Desktop Entries."
    "start:Generates units for given compositor command line or Desktop Entry and starts compositor."
    "stop:Stops compositor and optionally removes generated units."
  )
  _describe ' commands' _commands
}

_uwsm_aux_commands() {
  local _commands=(
    "app-daemon:Receives app arguments from a named pipe, returns shell code"
    "cleanup-env:Cleans up systemd user activation environment from previously loaded session-related variables."
    "exec:Executes compositor command line or Desktop Entry."
    "prepare-env:Prepares environment variables, loads into systemd user activation environment."
    "waitenv:Exits successfully when WAYLAND_DISPLAY (and optionally other vars) appear in systemd user manager activation environment. Optinal vars are read from command line and whitespace-separated UWSM_WAIT_VARNAMES var."
    "waitpid:Exits successfully when a process by given PID ends, or if it does not exist."
  )
  _describe ' aux commands' _commands
}

_uwsm_check_commands() {
  local _commands=(
    "is-active:Checks for specific compositor or graphical-session\*.target in general in active or activating state"
    "may-start:Checks whether it is OK to launch a wayland session."
  )
  _describe ' check commands' _commands
}

_uwsm_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "(- : *)"{-v,--version}"[print version and exit]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_defaults_added=0

_uwsm_app_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "-s[Slice selector\:

  - \\[4ma\\[0mpp-graphical.slice

  - \\[4mb\\[0mackground-graphical.slice

  - \\[4ms\\[0mession-graphical.slice

  - custom by full name

(default\: a)
]:slice_name:"
  "-t[Type of unit to launch (default\: scope, can be preset by UWSM_APP_UNIT_TYPE env var).]:app_unit_type:(scope service)"
  "-a[Override app name (a substring in unit name).]:app_name:"
  "-u[Override the whole autogenerated unit name.]:unit_name:"
  "-d[Unit Description.]:unit_description:"
  "*-p[Pass Unit property assignment.]:unit_properties:"
  "-S[Silence stdout, stderr, or both.]:silent:(out err both)"
  "-T[Launch app in a terminal, or just a terminal if command is empty.]"
  "(*):Application command line. The first argument can be either one of\::"
)

# guard to ensure default positional specs are added only once per session
_uwsm_app_defaults_added=0

_uwsm_aux_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_defaults_added=0

_uwsm_aux_app_daemon_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_app_daemon_defaults_added=0

_uwsm_aux_cleanup_env_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_cleanup_env_defaults_added=0

_uwsm_aux_exec_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  ":Compositor ID.:"
  "(*)::Full Compositor command line.:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_exec_defaults_added=0

_uwsm_aux_prepare_env_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "-D[Names to fill XDG_CURRENT_DESKTOP with (\:-separated).

Existing var content is a starting point if no active session is running.]:desktop_names:"
  "-a[Append desktop names set by -D to other sources (default).]"
  "-e[Use desktop names set by -D exclusively, discard other sources.]"
  "-N[Fancy name for compositor (filled from Desktop Entry by default).]:wm_name:"
  "-C[Fancy description for compositor (filled from Desktop Entry by default).]:wm_comment:"
  ":Compositor ID.:"
  "(*)::Full Compositor command line.:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_prepare_env_defaults_added=0

_uwsm_aux_waitenv_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "(*)::Names of additional variables to wait for:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_waitenv_defaults_added=0

_uwsm_aux_waitpid_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  ":PID to wait for:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_aux_waitpid_defaults_added=0

_uwsm_check_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_check_defaults_added=0

_uwsm_check_is_active_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "-v[Show additional info.]"
  ":Specify compositor by executable or Desktop Entry (without arguments).:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_check_is_active_defaults_added=0

_uwsm_check_may_start_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "-v[Show all failed tests.]"
  "-q[Do not show anything.]"
  "-i[Do not check for login shell.]"
  "-g[Seconds to wait for graphical.target in queue (default\: 60\; 0 or less disables check).]:gst_seconds:"
  "(*)::VT numbers allowed for startup (default\: 1\; disable check\: 0).:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_check_may_start_defaults_added=0

_uwsm_finalize_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "(*)::Additional vars to export by name. Direct assignment \"VAR_NAME\=value\" is also possible, but recommended only for creating flags for \"UWSM_WAIT_VARNAMES\" mechanism.:"
)

# guard to ensure default positional specs are added only once per session
_uwsm_finalize_defaults_added=0

_uwsm_select_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_select_defaults_added=0

_uwsm_start_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "-D[Names to fill XDG_CURRENT_DESKTOP with (\:-separated).

Existing var content is a starting point if no active session is running.]:desktop_names:"
  "-a[Append desktop names set by -D to other sources (default).]"
  "-e[Use desktop names set by -D exclusively, discard other sources.]"
  "-N[Fancy name for compositor (filled from Desktop Entry by default).]:wm_name:"
  "-C[Fancy description for compositor (filled from Desktop Entry by default).]:wm_comment:"
  "-U[Generated unit\/drop-in files destination (default\: run, can be preset by UWSM_UNIT_RUNG env var).]:unit_rung:(run home)"
  "-t[Do not generate tweak drop-ins (can be preset by UWSM_TWEAKS\=false env var).]"
  "-T[Generate tweak drop-ins (default).]"
  "-F[Hardcode resulting command line (with path) to unit drop-ins.]"
  "-g[Seconds to wait for graphical.target in queue and warn if timed out (default\: 60\; negative to disable).]:gst_warn_seconds:"
  "-G[Seconds to wait for graphical.target in queue and abort if timed out (takes precedence over -g, default\: -1 (disabled)).]:gst_abort_seconds:"
  "-o[Only generate units, but do not start.]"
  "-n[Dry run, do not write or start anything.]"
  "(*):Compositor command line. The first argument acts as an ID and should be either one of\::"
)

# guard to ensure default positional specs are added only once per session
_uwsm_start_defaults_added=0

_uwsm_stop_options=(
  "(- : *)"{-h,--help}"[show this help message and exit]"
  "-r[Also remove unit files, all or only with specific mark(s) (compositor ID, \"tweaks\", \"generic\" as comma-separated list).]:remove_units:"
  "-U[Generated unit\/drop-in files destination (default\: run, can be preset by UWSM_UNIT_RUNG env var).]:unit_rung:(run home)"
  "-n[Dry run, do not stop or remove anything.]"
)

# guard to ensure default positional specs are added only once per session
_uwsm_stop_defaults_added=0


_uwsm() {
  local context state line curcontext="$curcontext" one_or_more='(*)' remainder='(-)*' default='*::: :->'

  # Add default positional/remainder specs only if none exist, and only once per session
  if (( ! _uwsm_defaults_added )); then
    if (( ${_uwsm_options[(I)${(q)one_or_more}*]} +          ${_uwsm_options[(I)${(q)remainder}*]} +          ${_uwsm_options[(I)${(q)default}]} == 0 )); then
      _uwsm_options+=(': :_uwsm_commands' '*::: :->')
    fi
    _uwsm_defaults_added=1
  fi
  _arguments -C -s $_uwsm_options

  case $state in
    *)
      words=($line[1] "${words[@]}")
      (( CURRENT += 1 ))
      curcontext="${curcontext%:*:*}:_uwsm-$line[1]:"
      case $line[1] in
        app) _arguments -C -s $_uwsm_app_options ;;
        aux) _uwsm_aux ;;
        check) _uwsm_check ;;
        finalize) _arguments -C -s $_uwsm_finalize_options ;;
        select) _arguments -C -s $_uwsm_select_options ;;
        start) _arguments -C -s $_uwsm_start_options ;;
        stop) _arguments -C -s $_uwsm_stop_options ;;
      esac
  esac
}

_uwsm_aux() {
  local context state line curcontext="$curcontext" one_or_more='(*)' remainder='(-)*' default='*::: :->aux'

  # Add default positional/remainder specs only if none exist, and only once per session
  if (( ! _uwsm_aux_defaults_added )); then
    if (( ${_uwsm_aux_options[(I)${(q)one_or_more}*]} +          ${_uwsm_aux_options[(I)${(q)remainder}*]} +          ${_uwsm_aux_options[(I)${(q)default}]} == 0 )); then
      _uwsm_aux_options+=(': :_uwsm_aux_commands' '*::: :->aux')
    fi
    _uwsm_aux_defaults_added=1
  fi
  _arguments -C -s $_uwsm_aux_options

  case $state in
    aux)
      words=($line[1] "${words[@]}")
      (( CURRENT += 1 ))
      curcontext="${curcontext%:*:*}:_uwsm_aux-$line[1]:"
      case $line[1] in
        app-daemon) _arguments -C -s $_uwsm_aux_app_daemon_options ;;
        cleanup-env) _arguments -C -s $_uwsm_aux_cleanup_env_options ;;
        exec) _arguments -C -s $_uwsm_aux_exec_options ;;
        prepare-env) _arguments -C -s $_uwsm_aux_prepare_env_options ;;
        waitenv) _arguments -C -s $_uwsm_aux_waitenv_options ;;
        waitpid) _arguments -C -s $_uwsm_aux_waitpid_options ;;
      esac
  esac
}

_uwsm_check() {
  local context state line curcontext="$curcontext" one_or_more='(*)' remainder='(-)*' default='*::: :->check'

  # Add default positional/remainder specs only if none exist, and only once per session
  if (( ! _uwsm_check_defaults_added )); then
    if (( ${_uwsm_check_options[(I)${(q)one_or_more}*]} +          ${_uwsm_check_options[(I)${(q)remainder}*]} +          ${_uwsm_check_options[(I)${(q)default}]} == 0 )); then
      _uwsm_check_options+=(': :_uwsm_check_commands' '*::: :->check')
    fi
    _uwsm_check_defaults_added=1
  fi
  _arguments -C -s $_uwsm_check_options

  case $state in
    check)
      words=($line[1] "${words[@]}")
      (( CURRENT += 1 ))
      curcontext="${curcontext%:*:*}:_uwsm_check-$line[1]:"
      case $line[1] in
        is-active) _arguments -C -s $_uwsm_check_is_active_options ;;
        may-start) _arguments -C -s $_uwsm_check_may_start_options ;;
      esac
  esac
}



typeset -A opt_args

if [[ $zsh_eval_context[-1] == eval ]]; then
  # eval/source/. command, register function for later
  compdef _uwsm uwsm
else
  # autoload from fpath, call function directly
  _uwsm "$@"
fi

