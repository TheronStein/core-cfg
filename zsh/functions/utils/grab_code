#!/usr/bin/env zsh
# Grab only code files (exclude common non-code files)

local files=""
local count=0

# Use fd to find code files, excluding common non-code patterns
local code_files=$(fd --type f \
    --exclude node_modules \
    --exclude .git \
    --exclude dist \
    --exclude build \
    --exclude "*.min.js" \
    --exclude "*.lock" \
    -e js -e ts -e jsx -e tsx -e py -e rs -e go -e c -e cpp -e h -e hpp \
    -e lua -e vim -e sh -e zsh -e bash -e fish \
    -e css -e scss -e html -e json -e yaml -e toml -e md)

if [[ -z "$code_files" ]]; then
    echo "No code files found"
    return 1
fi

while IFS= read -r file; do
    files+="=== $file ===\n"
    files+="$(bat --style=plain --paging=never "$file" 2>/dev/null || cat "$file")\n\n"
    ((count++))
done <<< "$code_files"

echo -e "$files" | wl-copy
echo "âœ“ Copied $count code files to clipboard"
