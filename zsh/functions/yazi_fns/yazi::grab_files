#!/usr/bin/env zsh
# Yazi integration for grabbing selected files

yazi::grab_files() {
    local tmp_file="/tmp/yazi-selected-$$"
    local files=""
    local count=0
    
    # Launch yazi in chooser mode
    yazi --chooser-file="$tmp_file"
    
    if [[ -f "$tmp_file" ]]; then
        while IFS= read -r file; do
            if [[ -f "$file" ]]; then
                files+="=== $file ===\n"
                files+="$(bat --style=plain --paging=never "$file" 2>/dev/null || cat "$file")\n\n"
                ((count++))
            fi
        done < "$tmp_file"
        
        if [[ -n "$files" ]]; then
            echo -e "$files" | wl-copy
            echo "âœ“ Copied $count files to clipboard"
        else
            echo "No valid files found"
        fi
        
        rm -f "$tmp_file"
    else
        echo "No files selected"
    fi
}

# Alias for convenience
alias ygrab='yazi::grab_files'
