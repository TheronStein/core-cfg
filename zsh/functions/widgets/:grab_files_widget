#!/usr/bin/env zsh
# Widget to interactively select and copy files using fzf

:grab_files_widget() {
    local selected_files
    local files=""
    local count=0
    
    # Use fzf for multi-select file picking with bat preview
    selected_files=$(fd --type f --hidden --exclude .git | \
        fzf --multi \
            --preview 'bat --color=always --style=numbers {}' \
            --preview-window=right:60% \
            --bind 'ctrl-/:toggle-preview' \
            --header 'Press TAB to select multiple, Enter to confirm, Ctrl-/ to toggle preview')
    
    if [[ -n "$selected_files" ]]; then
        while IFS= read -r file; do
            files+="=== $file ===\n"
            files+="$(bat --style=plain --paging=never "$file" 2>/dev/null || cat "$file")\n\n"
            ((count++))
        done <<< "$selected_files"
        
        echo -e "$files" | wl-copy
        zle -M "âœ“ Copied $count files to clipboard"
    else
        zle -M "No files selected"
    fi
    
    zle reset-prompt
}

# Register as widget (done in .zshrc, shown below)
