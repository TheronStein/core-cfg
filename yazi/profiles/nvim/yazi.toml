"$schema" = "https://yazi-rs.github.io/schemas/yazi.json"

[mgr]
ratio = [1, 4, 3]
sort_by = "alphabetical"
sort_sensitive = false
sort_reverse = false
sort_dir_first = true
sort_translit = false
linemode = "size"
show_hidden = true
show_symlink = true
scrolloff = 5
mouse_events = ["click", "scroll"]
title_format = "Yazi: {cwd}"

[image]
protocol = "inline"
# min_width = 1600
# min_height = 1200
max_width = 3000
max_height = 3000

[preview]
# wrap = "no"
# tab_size = 2
max_width = 3000
max_height = 3000
# cache_dir = ""                 # Empty means use default, or remove this line entirely
# image_delay = 30               # Increased back to 30 for stability
# image_filter = "triangle"
# image_quality = 90
# ueberzug_scale = 1
# ueberzug_offset = [0, 0, 0, 0]

[opener]

# Custom opener for nvim sidebar - writes to chooser file without closing yazi
nvim_open = [
  { run = '''echo "$@" >> "$YAZI_CHOOSER_FILE"''', orphan = true, desc = "Open in nvim (keep yazi open)" },
]

# Define openers for different file types
edit = [
  { run = '''echo "$@" >> "$YAZI_CHOOSER_FILE"''', orphan = true, desc = "Open in nvim (keep yazi open)" },
]

open = [{ run = 'xdg-open "$@"', desc = "Open", for = "linux" }]

reveal = [
  { run = 'xdg-open "$(dirname "$0")"', desc = "Reveal", for = "linux" },
]

play = [{ run = 'mpv --force-window "$@"', orphan = true, for = "unix" }]

extract = [
  { run = 'ya pub extract --list "$@"', desc = "Extract here", for = "unix" },
  { run = '7z x "$@"', desc = "Extract with 7z" },
]

slideshow = [
  { run = '''feh --slideshow-delay 3 --zoom fill --auto-rotate --recursive --randomize --geometry 1920x1080 --hide-pointer --fullscreen --draw-filename --draw-exif "$PWD"''', desc = "Slideshow (current dir)", orphan = true, for = "unix" },
]
slideshow_custom = [
  { run = '''feh --slideshow-delay 5 --zoom max --recursive --sort name --borderless --image-bg black --info "echo %f: %wx%h" "$PWD"''', desc = "Custom slideshow", orphan = true, for = "unix" },
]
slideshow_selected = [
  { run = '''feh --slideshow-delay 3 --zoom fill --fullscreen "$@"''', desc = "Slideshow (selected)", orphan = true, for = "unix" },
]

# Special openers for rclone files
rclone_download = [
  { run = 'mkdir -p /tmp/yazi-downloads && rclone copy "$@" /tmp/yazi-downloads/ && xdg-open "/tmp/yazi-downloads/$(basename "$@")"', desc = "Download and open" },
]

rclone_stream_video = [
  { run = 'rclone cat "$@" | mpv -', desc = "Stream video with mpv" },
]

rclone_stream_audio = [
  { run = 'rclone cat "$@" | mpv --no-video -', desc = "Stream audio with mpv" },
]

rclone_edit = [
  { run = 'mkdir -p /tmp/yazi-edit && rclone copy "$@" /tmp/yazi-edit/ && nvim "/tmp/yazi-edit/$(basename "$@")" && rclone copy "/tmp/yazi-edit/$(basename "$@")" "$(dirname "$@")/"', block = true, desc = "Download, edit, and upload" },
]

[open]
rules = [
  # Directories
  { name = "*/", use = [
    "open",
    "nvim_open",
    "reveal",
  ] },

  # Text files - open in nvim without closing yazi
  { mime = "text/*", use = [
    "nvim_open",
    "reveal",
  ] },

  # Images
  { mime = "image/*", use = [
    "open",
    "reveal",
    "slideshow",
    "slideshow_selected",
  ] },

  # Videos - with rclone streaming support
  { mime = "video/*", use = [
    "play",
    "reveal",
  ] },

  # Audio - with rclone streaming support
  { mime = "audio/*", use = [
    "play",
    "reveal",
  ] },

  # Empty files
  { mime = "inode/x-empty", use = [
    "nvim_open",
    "reveal",
  ] },

  # JSON files
  { mime = "application/json", use = [
    "nvim_open",
    "reveal",
  ] },

  # Archives
  { mime = "application/zip", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/gzip", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-tar", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-bzip", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-bzip2", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-7z-compressed", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-rar", use = [
    "extract",
    "reveal",
  ] },

  # PDFs
  { mime = "application/pdf", use = [
    "open",
    "reveal",
  ] },

  # Default fallback - try nvim first, then system open
  { mime = "*", use = [
    "nvim_open",
    "open",
    "reveal",
  ] },
]


[tasks]
micro_workers = 5
macro_workers = 10
bizarre_retry = 5

preloaders = [
  { name = "*/", run = "folder", sync = true },
  { mime = "image/vnd.djvu", run = "noop" },
  { mime = "image/*", run = "image" },
  { mime = "video/*", run = "video" },
  { mime = "application/pdf", run = "pdf" },
]
# previewers = [
#   { name = "*/", run = "folder" },
#   { mime = "text/*", run = "code" },
#   { mime = "*/xml", run = "code" },
#   { mime = "*/javascript", run = "code" },
#   { mime = "*/x-wine-extension-ini", run = "code" },
#   { mime = "application/json", run = "json" },
#   { mime = "image/vnd.djvu", run = "noop" },
#   { mime = "video/*", run = "video" },
#   { mime = "application/pdf", run = "pdf" },
#   { mime = "application/zip", run = "archive" },
#   { mime = "application/gzip", run = "archive" },
#   { mime = "application/x-tar", run = "archive" },
#   { mime = "application/x-bzip", run = "archive" },
#   { mime = "application/x-bzip2", run = "archive" },
#   { mime = "application/x-7z-compressed", run = "archive" },
#   { mime = "application/x-rar", run = "archive" },
#   { mime = "*", run = "file" },
# ]


[input]
cursor_blink = false
cd_title = "Change directory:"
cd_origin = "top-center"
cd_offset = [0, 2, 50, 3]
create_title = ["Create:", "Create (dir):"]
create_origin = "top-center"
create_offset = [0, 2, 50, 3]
rename_title = "Rename:"
rename_origin = "hovered"
rename_offset = [0, 1, 50, 3]
filter_title = "Filter:"
filter_origin = "top-center"
filter_offset = [0, 2, 50, 3]
find_title = ["Find next:", "Find previous:"]
find_origin = "top-center"
find_offset = [0, 2, 50, 3]
search_title = "Search via {n}:"
search_origin = "top-center"
search_offset = [0, 2, 50, 3]
shell_title = ["Shell:", "Shell (block):"]
shell_origin = "top-center"
shell_offset = [0, 2, 50, 3]

[confirm]
trash_title = "Trash {n} selected file{s}?"
trash_origin = "center"
trash_offset = [0, 0, 70, 20]
delete_title = "Permanently delete {n} selected file{s}?"
delete_origin = "center"
delete_offset = [0, 0, 70, 20]
overwrite_title = "Overwrite file?"
overwrite_content = "Will overwrite the following file:"
overwrite_origin = "center"
overwrite_offset = [0, 0, 50, 15]
quit_title = "Quit?"
quit_content = "The following tasks are still running, are you sure you want to quit?"
quit_origin = "center"
quit_offset = [0, 0, 50, 15]

[pick]
open_title = "Open with:"
open_origin = "hovered"
open_offset = [0, 1, 50, 7]

[which]
sort_by = "none"
sort_sensitive = false
sort_reverse = false
sort_translit = false

[log]
enabled = false


reveal = [{ run = 'echo "$@"', desc = "Show path" }]

play = [{ run = 'mpv "$@"', desc = "Play with mpv" }]
# extract = [
#     { run = 'ya pub extract --list "$@"', desc = "Extract here", for = "unix" },
# ]

# slideshow = [
#     { run = 'feh -F -Z -r -z "$@"', desc = "Slideshow with feh" },
# ]

# slideshow_selected = [
#     { run = 'feh -F -Z -z "$@"', orphan = true, desc = "Slideshow selected with feh" },
# ]
#
# [open]
# rules = [
#     { name = "*/", use = [
#         "edit",
#         "open",
#         "reveal",
#         "slideshow",
#     ] },
#     { mime = "text/*", use = [
#         "edit",
#         "reveal",
#     ] },
#     { mime = "image/*", use = [
#         "open",
#         "reveal",
#         "slideshow",
#         "slideshow_selected",
#     ] },
#     { mime = "video/*", use = [
#         "play",
#         "reveal",
#     ] },
#     { mime = "audio/*", use = [
#         "play",
#         "reveal",
#     ] },
#     { mime = "inode/x-empty", use = [
#         "edit",
#         "reveal",
#     ] },
#     { mime = "application/json", use = [
#         "edit",
#         "reveal",
#     ] },
#     { mime = "application/zip", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/gzip", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/x-tar", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/x-bzip", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/x-bzip2", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/x-7z-compressed", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/x-rar", use = [
#         "extract",
#         "reveal",
#     ] },
#     { mime = "application/pdf", use = [
#         "open",
#         "reveal",
#     ] },
#     { mime = "*", use = [
#         "open",
#         "reveal",
#     ] },
# ]

# [tasks]
# micro_workers = 10
# macro_workers = 25
# bizarre_retry = 5
# image_alloc = 1073741824
# image_bound = [0, 0]
# suppress_preload = false

# [plugin]
# prepend_previewers = [{ name = "*.md", run = "glow" }]

# [plugin]
# fetchers = [
#     { id = "git", name = "*", run = "git" },
#     { id = "git", name = "*/", run = "git" },
# ]
