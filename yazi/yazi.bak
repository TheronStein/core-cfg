[mgr]
ratio = [1, 4, 3]
sort_by = "alphabetical"
sort_sensitive = false
sort_reverse = false
sort_dir_first = true
sort_translit = false
linemode = "size"
show_hidden = true
show_symlink = true
scrolloff = 5
mouse_events = ["click", "scroll"]
title_format = "Yazi: {cwd}"

[image]
protocol = "inline"
# min_width = 1600
# min_height = 1200
max_width = 3000
max_height = 3000

[preview]
wrap = "no"
tab_size = 2
max_width = 3000
max_height = 3000
cache_dir = ""
image_delay = 30
image_filter = "triangle"
image_quality = 90
ueberzug_scale = 1
ueberzug_offset = [0, 0, 0, 0]

[opener]

# edit = [{ run = '$EDITOR "$@"', desc = "$EDITOR", block = true, for = "unix" }]
# edit = [
# { run = '~/.config/yazi/scripts/open-in-nvim.sh "$@"', desc = "Open in Neovim" },
# ]

# Define openers for different file types
edit = [{ run = 'nvim "$@"', block = true, desc = "Edit with nvim" }]

open = [{ run = 'xdg-open "$@"', desc = "Open", for = "linux" }]

reveal = [
  { run = 'xdg-open "$(dirname "$0")"', desc = "Reveal", for = "linux" },
]

play = [{ run = 'mpv --force-window "$@"', orphan = true, for = "unix" }]

extract = [
  { run = 'ya pub extract --list "$@"', desc = "Extract here", for = "unix" },
  { run = '7z x "$@"', desc = "Extract with 7z" },
]

slideshow = [
  { run = '''feh --slideshow-delay 3 --zoom fill --auto-rotate --recursive --randomize --geometry 1920x1080 --hide-pointer --fullscreen --draw-filename --draw-exif "$PWD"''', desc = "Slideshow (current dir)", orphan = true, for = "unix" },
]
slideshow_custom = [
  { run = '''feh --slideshow-delay 5 --zoom max --recursive --sort name --borderless --image-bg black --info "echo %f: %wx%h" "$PWD"''', desc = "Custom slideshow", orphan = true, for = "unix" },
]
slideshow_selected = [
  { run = '''feh --slideshow-delay 3 --zoom fill --fullscreen "$@"''', desc = "Slideshow (selected)", orphan = true, for = "unix" },
]

# Special openers for rclone files
rclone_download = [
  { run = 'mkdir -p /tmp/yazi-downloads && rclone copy "$@" /tmp/yazi-downloads/ && xdg-open "/tmp/yazi-downloads/$(basename "$@")"', desc = "Download and open" },
]

rclone_stream_video = [
  { run = 'rclone cat "$@" | mpv -', desc = "Stream video with mpv" },
]

rclone_stream_audio = [
  { run = 'rclone cat "$@" | mpv --no-video -', desc = "Stream audio with mpv" },
]

rclone_edit = [
  { run = 'mkdir -p /tmp/yazi-edit && rclone copy "$@" /tmp/yazi-edit/ && nvim "/tmp/yazi-edit/$(basename "$@")" && rclone copy "/tmp/yazi-edit/$(basename "$@")" "$(dirname "$@")/"', block = true, desc = "Download, edit, and upload" },
]

[open]
rules = [
  # Directories
  { name = "*/", use = [
    "open",
    "edit",
    "reveal",
  ] },

  # Text files
  { mime = "text/*", use = [
    "edit",
    "reveal",
  ] },

  # Images
  { mime = "image/*", use = [
    "open",
    "reveal",
    "slideshow",
    "slideshow_selected",
  ] },

  # Videos - with rclone streaming support
  { mime = "video/*", use = [
    "play",
    "reveal",
  ] },

  # Audio - with rclone streaming support
  { mime = "audio/*", use = [
    "play",
    "reveal",
  ] },

  # Empty files
  { mime = "inode/x-empty", use = [
    "edit",
    "reveal",
  ] },

  # JSON files
  { mime = "application/json", use = [
    "edit",
    "reveal",
  ] },

  # Archives
  { mime = "application/zip", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/gzip", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-tar", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-bzip", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-bzip2", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-7z-compressed", use = [
    "extract",
    "reveal",
  ] },
  { mime = "application/x-rar", use = [
    "extract",
    "reveal",
  ] },

  # PDFs
  { mime = "application/pdf", use = [
    "open",
    "reveal",
  ] },

  # Default fallback
  { mime = "*", use = [
    "open",
    "reveal",
  ] },
]


[tasks]
micro_workers = 5
macro_workers = 10
bizarre_retry = 5
image_alloc = 1073741824

[plugin]
prepend_preloaders = [
  { mime = "{audio,video,image}/*", run = "mediainfo" },
  { mime = "application/subrip", run = "mediainfo" },
  { mime = "application/postscript", run = "mediainfo" },
]
prepend_previewers = [
  # Images - built-in image previewer
  { mime = "image/*", run = "image" },

  # Videos - built-in thumbnail generator
  { mime = "video/*", run = "video" },

  # PDFs - built-in PDF previewer
  { mime = "application/pdf", run = "pdf" },

  # Archives - built-in archive lister
  { mime = "application/*zip", run = "archive" },
  { mime = "application/x-tar", run = "archive" },
  { mime = "application/x-bzip2", run = "archive" },
  { mime = "application/x-7z-compressed", run = "archive" },
  { mime = "application/x-rar", run = "archive" },
  { mime = "application/vnd.rar", run = "archive" },
  { mime = "application/x-xz", run = "archive" },
  { mime = "application/xz", run = "archive" },
  { mime = "application/x-zstd", run = "archive" },
  { mime = "application/zstd", run = "archive" },
  { mime = "application/java-archive", run = "archive" },

  # JSON - built-in JSON previewer
  { mime = "application/{json,x-ndjson}", run = "json" },

  # Directories - built-in folder listing
  { name = "*/", run = "folder" },

  # Code/Text files - built-in syntax highlighting
  { mime = "text/*", run = "code" },
  { mime = "*/xml", run = "code" },
  { mime = "*/javascript", run = "code" },
  { mime = "*/x-shellscript", run = "code" },
]
prepend_fetchers = [
  { id = "git", name = "*", run = "git" },
  { id = "git", name = "*/", run = "git" },
]

append_fetchers = [
  { id = "fzf", name = "*", run = "fzf" },
  { id = "fzf", name = "*/", run = "fzf" },
  { id = "zoxide", name = "*", run = "zoxide" },
  { id = "zoxide", name = "*/", run = "zoxide" },
]
