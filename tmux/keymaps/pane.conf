
# ============================================================================
# LAYOUT MANAGER - Fixed Dimension Panes
# ============================================================================
# Lock/unlock current pane dimensions
bind -N "Toggle dimension lock on current pane" M-L run-shell '$TMUX_CONF/scripts/layout-manager.sh toggle-lock'

# List all locked panes
bind -N "List locked panes" M-I run-shell '$TMUX_CONF/scripts/layout-manager.sh list'

# Manually restore locked dimensions
bind -N "Restore all locked pane dimensions" M-R run-shell '$TMUX_CONF/scripts/layout-manager.sh restore'

# == Resize / Split =========================================================
# Smart pane switching with awareness of Vim splits and WezTerm panes
# Meta+W/A/S/D will work in tmux -> nvim -> wezterm contextually

# Navigation with Meta+W/A/S/D using smart navigation script
bind-key -n M-w run-shell "$TMUX_CONF/scripts/smart-navigate.sh U w C-S"
bind-key -n M-s run-shell "$TMUX_CONF/scripts/smart-navigate.sh D s C-S"
bind-key -n M-a run-shell "$TMUX_CONF/scripts/smart-navigate.sh L a C-S"
bind-key -n M-d run-shell "$TMUX_CONF/scripts/smart-navigate.sh R d C-S"

# Navigation with Meta+W/A/S/D
bind-key -n C-S-w if-shell "$is_vim" 'send-keys C-S-w' 'select-pane -U'
bind-key -n C-S-s if-shell "$is_vim" 'send-keys C-S-s' 'select-pane -D'
bind-key -n C-S-a if-shell "$is_vim" 'send-keys C-S-a' 'select-pane -L'
bind-key -n C-S-d if-shell "$is_vim" 'send-keys C-S-d' 'select-pane -R'

# FZF panes integration
# if "[[ -x $COREBIN/fzf-panes.tmux ]]" \
#     'set -g "@fzf_panes_ex_session_pat" "^(floating)$"; \
#      set-hook -g pane-focus-in[10] "if -F \"#{&&:#{!=:#{client_key_table},resize},#{!=:#{session_name},floating}}\" \"run -b \\\"$COREBIN/fzf-panes.tmux update_mru_pane_ids\\\"\""; \
#      bind -N "Move to selected window" C-m run -b "$COREBIN/fzf-panes.tmux new_window"; \
#      bind -N "Move to last window" C-b run -b "$COREBIN/fzf-panes.tmux select_last_pane"; \
#     bind -N "Move to selected window" -n M-m run -b "$COREBIN/fzf-panes.tmux new_window"' \
#     'set-hook -ug pane-focus-in[10]; \
#      # bind -N "Move to selected window" C-m choose-tree -Z; \
#      # bind -N "Move to last window" C-b choose-tree "movep -v -s \"%%\""; \
#      bind -N "Move to selected window" C-m choose-tree "movep -h -s \"%%\""'


if "[[ -x $HOME/.core/env/bin/fzf-panes.tmux ]]" {
    set -g '@fzf_panes_ex_session_pat' '^(floating)$'
    set-hook -g pane-focus-in[10] "if -F \
        '#{&&:#{!=:#{client_key_table},resize},#{!=:#{session_name},floating}}' \
        'run -b \"$HOME/.core/env/bin/fzf-panes.tmux update_mru_pane_ids\"'"
    bind -N "Move to selected window"     .  run -b "$HOME/.core/env/bin/fzf-panes.tmux new_window"
    bind -N "Move to selected window"     w  run -b "$HOME/.core/env/bin/fzf-panes.tmux new_window"
    bind -N "Move to last window"        ';' run -b "$HOME/.core/env/bin/fzf-panes.tmux select_last_pane"
    bind -N "Move to selected window" -n M-= run -b "$HOME/.core/env/bin/fzf-panes.tmux new_window"
} {
    set-hook -ug pane-focus-in[10]
    bind -N "Move to selected window" w choose-tree -Z
    bind -N "Move to last window"     S choose-tree { movep -v -s "%%" }
    bind -N "Move to selected window" V choose-tree { movep -h -s "%%" }
}

# Pane operations
bind -N "Swap pane with selected pane" M-v displayp "swapp -t '%%'"
bind -N "Display pane numbers" 'M-#' displayp
bind -N "Renumber panes sequentially" M-r run-shell "$TMUX_CONF/scripts/renumber-panes.sh"


# bind -N "Break pane, send to end, follow" b \
#   if -F '#{!=:#S,floating}' \
#     'breakp' \
#     'set -uw pane-border-status; \
#      run "$COREBIN/fzf-panes.tmux update_mru_pane_ids"; \
#      run "bash -c \"tmux breakp -s floating -t \\\"$(tmux show -gvq \"@last_session_name\"):\\\"\""'
#
# bind -N "Break pane, send to end, don't follow" 'B' \
#   if -F '#{!=:#S,floating}' \
#     'breakp -d' \
#     'set -uw pane-border-status; \
#      run "$COREBIN/fzf-panes.tmux update_mru_pane_ids"; \
#      run "bash -c \"tmux breakp -d -s floating -t \\\"$(tmux show -gvq \"@last_session_name\"):\\\"\""'

# These simple bindings are replaced by smart vim-aware bindings below (lines ~107-110)
# bind-key -n M-a select-pane -L    # Mod3+h
# bind-key -n M-s select-pane -D    # Mod3+j
# bind-key -n M-w select-pane -U    # Mod3+k
# bind-key -n M-d select-pane -R    # Mod3+l

