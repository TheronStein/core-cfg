
# ============================================================================
# LAYOUT MANAGER - Fixed Dimension Panes
# ============================================================================
# The layout manager allows you to lock pane dimensions so they persist
# across window resizes and pane operations.
#
# IMPORTANT: The window-resized hook was removed to prevent feedback loops.
# If panes resize unexpectedly (e.g., after attaching with different terminal
# size or toggling sidebars), use prefix + M-R to restore locked dimensions.
#
# Lock/unlock current pane dimensions
bind -N "Toggle dimension lock on current pane" M-L run-shell '$TMUX_CONF/scripts/layout-manager.sh toggle-lock'

# List all locked panes
bind -N "List locked panes" M-I run-shell '$TMUX_CONF/scripts/layout-manager.sh list'

# Manually restore locked dimensions (use when window resize occurs)
bind -N "Restore all locked pane dimensions" M-R run-shell '$TMUX_CONF/scripts/layout-manager.sh restore'


bind-key -r ">" swap-window -d -t +1

# == Resize / Split =========================================================
# Smart pane switching with awareness of Vim splits and WezTerm panes
# Meta+W/A/S/D will work in tmux -> nvim -> wezterm contextually

# FZF panes integration
# if "[[ -x $COREBIN/fzf-panes.tmux ]]" \
#     'set -g "@fzf_panes_ex_session_pat" "^(floating)$"; \
#      set-hook -g pane-focus-in[10] "if -F \"#{&&:#{!=:#{client_key_table},resize},#{!=:#{session_name},floating}}\" \"run -b \\\"$COREBIN/fzf-panes.tmux update_mru_pane_ids\\\"\""; \
#      bind -N "Move to selected window" C-m run -b "$COREBIN/fzf-panes.tmux new_window"; \
#      bind -N "Move to last window" C-b run -b "$COREBIN/fzf-panes.tmux select_last_pane"; \
#     bind -N "Move to selected window" -n M-m run -b "$COREBIN/fzf-panes.tmux new_window"' \
#     'set-hook -ug pane-focus-in[10]; \
#      # bind -N "Move to selected window" C-m choose-tree -Z; \
#      # bind -N "Move to last window" C-b choose-tree "movep -v -s \"%%\""; \
#      bind -N "Move to selected window" C-m choose-tree "movep -h -s \"%%\""'

#
#
# if "[[ -x $HOME/.core/.sys/bin/fzf-panes.tmux ]]" {
#
#
#qset -g '@fzf_panes_ex_session_pat' '^(floating)$'
#     set-hook -g pane-focus-in[10] "if -F \
#         '#{&&:#{!=:#{client_key_table},resize},#{!=:#{session_name},floating}}' \
#         'run -b \"$HOME/.core/env/bin/fzf-panes.tmux update_mru_pane_ids\"'"
#     bind -N "Move to selected window"     .  run -b "$HOME/.core/env/bin/fzf-panes.tmux new_window"
#     bind -N "Move to selected window"     w  run -b "$HOME/.core/env/bin/fzf-panes.tmux new_window"
#     bind -N "Move to last window"        ';' run -b "$HOME/.core/env/bin/fzf-panes.tmux select_last_pane"
#     bind -N "Move to selected window" -n M-= run -b "$HOME/.core/env/bin/fzf-panes.tmux new_window"
# } {
#     set-hook -ug pane-focus-in[10]
#     bind -N "Move to selected window" w choose-tree -Z
#     bind -N "Move to last window"     S choose-tree { movep -v -s "%%" }
#     bind -N "Move to selected window" V choose-tree { movep -h -s "%%" }
# }

# Pane operations
# bind -N "Swap pane with selected pane" M-v displayp "swapp -t '%%'"
# bind -N "Display pane numbers" 'M-#' displayp
# bind -N "Renumber panes sequentially" M-r run-shell "$TMUX_CONF/scripts/renumber-panes.sh"


# bind -N "Break pane, send to end, follow" b \
#   if -F '#{!=:#S,floating}' \
#     'breakp' \
#     'set -uw pane-border-status; \
#      run "$COREBIN/fzf-panes.tmux update_mru_pane_ids"; \
#      run "bash -c \"tmux breakp -s floating -t \\\"$(tmux show -gvq \"@last_session_name\"):\\\"\""'
#
# bind -N "Break pane, send to end, don't follow" 'B' \
#   if -F '#{!=:#S,floating}' \
#     'breakp -d' \
#     'set -uw pane-border-status; \
#      run "$COREBIN/fzf-panes.tmux update_mru_pane_ids"; \
#      run "bash -c \"tmux breakp -d -s floating -t \\\"$(tmux show -gvq \"@last_session_name\"):\\\"\""'

# These simple bindings are replaced by smart vim-aware bindings below (lines ~107-110)
# bind-key -n M-a select-pane -L    # Mod3+h
# bind-key -n M-s select-pane -D    # Mod3+j
# bind-key -n M-w select-pane -U    # Mod3+k
# bind-key -n M-d select-pane -R    # Mod3+l

# # == Pane Switch ============================================================ [[[
# # Alternative M-j/k/i/l navigation (commented out in favor of M-w/s/a/d in binds-new.conf)
# # Smart pane switching with awareness of Vim splits.
# # See: https://github.com/christoomey/vim-tmux-navigator
# is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
#     | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
# #
# bind -n -N "Select the pane to the left" M-j \
#   if-shell "$is_vim" { send M-j } { if -F '#{pane_at_left}'   '' 'selectp -L' }
# bind -n -N "Select the pane to the bottom" M-k \
#   if-shell "$is_vim" { send M-k } { if -F '#{pane_at_bottom}' '' 'selectp -D' }
# bind -n -N "Select the pane to the Top" M-i \
#   if-shell "$is_vim" { send M-i } { if -F '#{pane_at_top}'    '' 'selectp -U' }
# bind -n -N "Select the pane to the right" M-l \
#   if-shell "$is_vim" { send M-l } { if -F '#{pane_at_right}'  '' 'selectp -R' }
#
# bind -T copy-mode-vi 'M-j' if -F '#{pane_at_left}' '' 'select-pane -L'
# bind -T copy-mode-vi 'M-k' if -F '#{pane_at_bottom}' '' 'select-pane -D'
# bind -T copy-mode-vi 'M-i' if -F '#{pane_at_top}' '' 'select-pane -U'
# bind -T copy-mode-vi 'M-l' if -F '#{pane_at_right}' '' 'select-pane -R'
# bind -T copy-mode-vi 'M-\' selectp -l
#
# bind -N "Join pane with current, horizontally" h      choose-tree { joinp -fv -s "%%" }
# bind -N "Join pane with current, vertically"   v      choose-tree { joinp -fh -s "%%" }
# bind -N "Join pane with current, horizontally" -n M-_ choose-tree { joinp -fv -s "%%" }
# bind -N "Join pane with current, vertically"   -n M-| choose-tree { joinp -fh -s "%%" }
