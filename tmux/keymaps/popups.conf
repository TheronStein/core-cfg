
# Floating shell (temporary floating session)
bind -n -N "Attach a floating shell" 'M-`' \
  if -F '#{==:#S,floating}' \
    'detach' \
    'set -gF "@last_session_name" "#S"; \
     detach -s floating; \
     popup -d "#{pane_current_path}" -xC -yC -w80% -h60% -E "tmux new -A -s floating \"tmux set -w pane-border-status off; TMUX_SESSION=floating $SHELL\""'


# == Menu / Popup Windows ================================================

# # == Neomutt ==
# bind -n -N "Open neomutt, new window" M-n {
#     neww -n email -c $HOME
#     send 'neomutt && tmux killw' 'Enter'
# }

bind -n -N "Toggle neomutt popup" M-n \
  if -F '#{==:#S,apps}' \
    'detach' \
    'run-shell "$TMUX_MODULES/popups/neomutt.sh"'

# bind -n -N "Toggle ncspot popup (apps session)" M-m \
#   if -F '#{==:#S,apps}' \
#     'detach' \
#     'run-shell "$TMUX_MODULES/popups/ncspot.sh"'

bind -n -N "Toggle spotify popup (apps session)" M-m \
  if -F '#{==:#S,apps}' \
    'detach' \
    'run-shell "$TMUX_MODULES/popups/spotify_player.sh"'

bind -n -N "Open btop" M-b \
  if -F '#{==:#S,apps}' \
    'detach' \
    'run-shell "$TMUX_MODULES/popups/btop.sh"'

bind -n -N "Open Hyprland keymaps" M-h \
  if -F '#{==:#S,apps}' \
    'detach' \
    'run-shell "$TMUX_MODULES/popups/hyprland-keymaps.sh"'

bind -n -N "Open colors" M-c \
  if -F '#{==:#S,apps}' \
    'detach' \
    'run-shell "$TMUX_MODULES/popups/colors.sh"'

bind -n -N "Open notes" M-N \
  if -F '#{==:#S,apps}' \
    'detach' \
    'run-shell "$TMUX_MODULES/popups/notes.sh"'


# # === RSS ===
# bind -N "Open newsboat, new window" C-n {
#     neww -n rss -c $HOME
#     send 'newsboat && tmux killw' 'Enter'
# }
#
# # === htop ===
# bind -N "Open htop, new window" C-h {
#     neww -n htop -c $HOME
#     send 'sudo htop && tmux killw' 'Enter'
# }
#
# # === task spooler ===
# bind -N "Open task-spooler, new window" M-t {
#     neww -n spool -c $HOME
#     send -t spool 'tsp -C && watch ts' 'Enter'
#     splitw -t spool -v
#     send -t spool 'TS_SOCKET=/tmp/fm tsp -C && watch TS_SOCKET=/tmp/fm tsp' 'Enter'
#     splitw -t spool -v -p 10
# }

# Close popup when in apps session with C-M-q
bind -n -N "Close apps popup" C-M-q \
  if -F '#{==:#S,apps}' \
    'detach' \
    'send-keys C-M-q'

# bind -N "Select words to paste from buffer (fzf)" t \
#      run 'tmux send-keys -t #{pane_id} "$(tmux-fzf-words)"'
#
# bind -N "Select words to paste from all buffers (fzf)" T \
#      run 'tmux send-keys -t #{pane_id} "$(tmux-fzf-words --all)"'


# == Buku Bookmarks (GUI) ==
# bind -N "Open buku (GUI), horizontally" 'M-\' {
#     splitw -fv
#     send 'bo && tmux kill-pane' 'Enter'
# }

# bind -N "Open buku (GUI)" b \
#   if -F '#{==:#S,floating}' {
#     detach
#   } {
#     set -gF '@last_session_name' '#S'
#     detach -s floating
#     popup -d '#{pane_current_path}' -xC -yC -w90% -h80% -E \
#       'tmux new -A -s floating \
#       "tmux set -w pane-border-status off; \
#        tmux set remain-on-exit off; \
#        TMUX_SESSION="floating" BUKU_FZF_OPTS="--height=100%" BUKU_NO_BG=1 fpath+=($ZDOTDIR/functions) && autoload -Uz bo && bo"'
#   }
#
# # == Buku Bookmarks (w3m) ===
# bind -N "Open buku (w3m), new window" 'C-\' {
#     neww -n bookmarks -c $HOME
#     send 'bow && tmux killw' 'Enter'
# }

# == Taskwarrior ==
bind -N "Open taskf" M-8 {
    splitw -fv
    send 'taskf && tmux kill-pane' 'Enter'
}

# === Taskwarrior TUI ===
bind -n -N "Open taskwarrior TUI, new window" M-9 {
    neww -n taskwarrior -c $HOME
    send 'taskwarrior-tui && tmux killw' 'Enter'
}
#
# == Tmux completion ==
bind -n -N "Select pane (fzf)" M-0 \
     run "tmux-fzf-panes || :"
bind -N "Select words to paste from buffer (fzf)"      t \
     run 'tmux send-keys -t #{pane_id} "$(tmux-fzf-words)"'
bind -N "Select words to paste from all buffers (fzf)" T \
     run 'tmux send-keys -t #{pane_id} "$(tmux-fzf-words --all)"'

bind -N "Capture pane and open in Neovim" M-c run \
  'FILE=/tmp/tmux-capture-$(date +%Y%m%d%H%M%S).txt; \
  tmux capture-pane -J -S -102400 -p > $FILE; \
  tmux neww "nvim $FILE"'

# bind j capture-pane \;\
#     save-buffer /tmp/tmux-buffer \;\
#     new-window -n "vim-copymode" '$SHELL -c "nvim /tmp/tmux-buffer"'


# Pass through C-q and C-e to applications
bind -n C-q send-keys C-q
bind -n C-e send-keys C-e


# vim: ft=tmux:et:sw=0:ts=2:sts=2:fdm=marker:fmr=[[[,]]]:
