# ============================================================================
# TERMINAL CONFIGURATION - Multi-Terminal Support
# ============================================================================
# Supports: WezTerm, Ghostty, Kitty (all use Kitty keyboard protocol)

# ============================================================================
# SERVER SETTINGS (set -s applies to the server)
# ============================================================================
set -s default-terminal "tmux-256color"
set -s escape-time 0                     # 0 required for yazi terminal queries, 10+ causes timeouts
set -s extended-keys always              # Force extended key sequences (kitty protocol)
set -s extended-keys-format csi-u        # Use CSI u format (kitty protocol)
set -s set-clipboard on                  # Use OSC 52 for clipboard
set -s focus-events on                   # Forward focus events to applications
set -s exit-empty on                     # Exit server when no sessions
set -s buffer-limit 200                  # Number of paste buffers
set -s editor "${EDITOR}"

# ============================================================================
# GLOBAL SESSION SETTINGS (set -g applies to all sessions)
# ============================================================================
set -g allow-passthrough on              # Required for sixel/images/OSC sequences

# Display
set -g display-time 2000
set -g display-panes-time 2000
set -g assume-paste-time 1               # Optimize for fast pasting

# Activity & bells
set -g monitor-activity on
set -g visual-activity off
set -g bell-action none
set -g visual-bell off

# ============================================================================
# TERMINAL FEATURES - Declare capabilities per terminal type
# ============================================================================
# Base features for tmux's internal terminal
set -as terminal-features ",*256col*:RGB:usstyle:overline:strikethrough:sync"

# Modern terminals - full feature set
# Format: RGB (true color), extkeys (extended keys), clipboard (OSC 52),
#         ccolour/cstyle (cursor), focus, mouse, strikethrough, usstyle (underline styles),
#         sync (synchronized output), hyperlinks (OSC 8)
set -as terminal-features ",wezterm*:RGB:extkeys:clipboard:ccolour:cstyle:focus:mouse:strikethrough:usstyle:sync:hyperlinks"
set -as terminal-features ",xterm-ghostty:RGB:extkeys:clipboard:ccolour:cstyle:focus:mouse:strikethrough:usstyle:sync:hyperlinks"
set -as terminal-features ",xterm-kitty:RGB:extkeys:clipboard:ccolour:cstyle:focus:mouse:strikethrough:usstyle:sync:hyperlinks"

# ============================================================================
# TERMINAL OVERRIDES - Escape sequences for features not in terminfo
# ============================================================================
# Undercurl support (curly underlines)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'

# Underscore/underline colors (RGB)
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# True color support
set -as terminal-overrides ',*256col*:Tc,wezterm*:Tc,ghostty:Tc,xterm-kitty:Tc'

# OSC 52 clipboard (explicit for remote/SSH scenarios)
set -as terminal-overrides ',wezterm*:Ms=\E]52;c;%p2%s\007'
set -as terminal-overrides ',xterm-ghostty:Ms=\E]52;c;%p2%s\007'
set -as terminal-overrides ',xterm-kitty:Ms=\E]52;c;%p2%s\007'

# ============================================================================
# SIXEL/IMAGE SUPPORT (uncomment if needed)
# ============================================================================
# set -as terminal-overrides ',wezterm*:sixel'
# set -as terminal-overrides ',ghostty:sixel'
# set -as terminal-overrides ',xterm-kitty:sixel'

# vim: ft=tmux:et:sw=2:ts=2:sts=2:fdm=marker:fmr=[[[,]]]:
