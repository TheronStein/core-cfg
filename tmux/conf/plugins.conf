# =============================================================================
# TPM (Tmux Plugin Manager) - MUST be declared first
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'

# TPM keybindings
set -g @tpm-install 'M-i'
set -g @tpm-update 'M-u'
set -g @tpm-clean "M-y"

set -g @1password-copy-to-clipboard 'yes'
set -g @1password-key 'C-F1'
# Session management settings
set-option -g @fzf-goto-session-only 'true'
set -g @fzf-goto-session 'M-w'
set -g @fzf-goto-win-width 70
set -g @fzf-goto-win-height 20


set -g @tmux-fzf-launch-key "f"
TMUX_FZF_OPTIONS="-p -w 80% -h 48% -m"

# FZF URLs plugin
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-fzf-options '-w 100% -h 50% --multi -0 --no-preview --reverse \
                              --color=fg:42,fg+:53,hl:22:bold,hl+:23,bg+:-1 \
                              --color=query:51,info:43:bold,border:33,separator:51,scrollbar:51 \
                              --color=label:27,preview-label:27 \
                              --color=pointer:17,marker:19,spinner:13 \
                              --color=header:12,prompt:18'
set -g @fzf-url-bind 'u'

# == Prefix-Highlight ======================================================= [[[
set -g @prefix_highlight_empty_prompt ' '
set -g @prefix_highlight_empty_attr "fg=#000000,bg=#000000"
set -g @prefix_highlight_prefix_prompt '[⌨]﬿'
set -g @prefix_highlight_fg '#000000'
set -g @prefix_highlight_bg '#000000'
set -g @prefix_highlight_copy_prompt '[C]﬿'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr "fg=#000000,bg=#000000"
set -g @prefix_highlight_sync_prompt '[S]﬿'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_sync_mode_attr "fg=#000000,bg=#000000"

set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# ]]]
# EasyJump plugin
set -g @easyjump-key-binding "j"
set -g @easyjump-label-chars "fjdkslaghrueiwoqptyvncmxzb1234567890"
set -g @easyjump-label-attrs "\e[1m\e[38;5;172m"
set -g @easyjump-text-attrs  "\e[0m\e[38;5;237m"
set -g @easyjump-smart-case  "on"
set -g @plugin "roy2220/easyjump.tmux"


set -g @fingers-key S
set -g @fingers-highlight-format '#[fg=green,bold,dim]%s'
set -g @fingers-hint-format '#[fg=yellow,bold,dim]%s'

set -g @menus_without_prefix 'Yes'
set -g @menus_trigger 'F1'
set -g @menus_display_commands 'Yes'
set -g @menus_display_cmds_cols 480

# Which-key plugin
set -g @tmux-which-key-xdg-enable 1
set -g @tmux-which-key-xdg-plugin-path "~/.tmux/plugins/tmux-which-key"
set -g @plugin "alexwforsythe/tmux-which-key"
set -g @which-key-config-file "~/.tmux/which-key-config.yaml"
set -g @browser_session_dir '$CORECFG/tmux/browser-sessions'
set -g @browser_dont_hook_to_resurrect '0'
set -g @browser_launch_on_attach '0'
set -g @browser_close_on_deattach '0'
set -g @new_browser_window 'zen-browser --new-window'
set -g @tea-alt-bind 'false'
# Conditional plugins
if-shell 'command -v xdg-open >/dev/null 2>&1' \
    "set -g @plugin 'tmux-plugins/tmux-open'" ''
if-shell 'command -v urlview >/dev/null 2>&1' \
    "set -g @plugin 'tmux-plugins/tmux-urlview'" ''
if-shell 'command -v fpp >/dev/null 2>&1' \
    "set -g @plugin 'jbnicolai/tmux-fpp'" ''

# FPP plugin settings
bind-key M-c run-shell '~/.tmux/plugins/tmux-fpp/fpp.tmux start edit'
bind-key M-b run-shell '~/.tmux/plugins/tmux-fpp/fpp.tmux start paste'

# Environment variable for display
# Kill session menu
set-environment -g EXEC_PREFIX "DISPLAY=$DISPLAY"

bind "k" display-popup -E "\
    tmux list-sessions -F '#{?session_attached,,#{session_name}}' |\
    fz --reverse -m --header=kill-session |\
    xargs -I {} tmux kill-session -t {}"

# Newline detector binding (conditional)
if '[ -f ~/.tmux/plugins/tmux-newline-detector/scripts/paste.sh ]' \
  'bind -n C-M-down run-shell "~/.tmux/plugins/tmux-newline-detector/scripts/paste.sh"'


# == Thumbs ================================================================= [[[
# set -g @plugin 'fcsonline/tmux-thumbs'
# set -g @thumbs-unique enabled
# set -g @thumbs-command 'echo -n {} | xsel -b && tmux display-message \"Copied {}\"'
# set -g @thumbs-regexp-1 '[a-z]+@[a-z]+.com' # Match emails
# set -g @thumbs-regexp-2 '[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:[a-f0-9]{2}:' # Match MAC addresses
# set -g @thumbs-regexp-3 'Vlan\d+' # match Vlan interface on network devices
# set -g @thumbs-regexp-4 "Vlan\\d+" # alternative method of defining regexp
# set -g @thumbs-regexp-5 Vlan\\d+ # alternative method of defining regexp
# set -g @thumbs-fg-color green
# set -g @thumbs-hint-fg-color blue
# set -g @thumbs-contrast 3
# ]]]
# ]]]

# Essential plugins
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "tmux-plugins/tmux-copycat"
set -g @plugin "tmux-plugins/tmux-yank"

set -g @plugin 'feqzz/tmux-spotify-info'
set -g @plugin 'xamut/tmux-spotify'
set -g @plugin "arl/gitmux"
set -g @plugin 'tardunge/tmux-gh'

# Plugins I am testing
set -g @plugin "laktak/extrakto"
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin '2kabhishek/tmux-tea'
set -g @plugin 'jaclu/tmux-menus'
# 1Password plugin
set -g @plugin 'yardnsm/tmux-1password'

# Fingers plugin
set -g @plugin "Morantron/tmux-fingers"

# FZF plugin
set -g @plugin 'sainnhe/tmux-fzf'
# Other plugins
set -g @plugin "sjdonado/tmux-workspace-usage"
set -g @plugin "jschaf/tmux-newline-detector"
set -g @plugin 'jaclu/tmux-power-zoom'
set -g @plugin 'ofirgall/tmux-browser'

 # Additional plugins
set -g @plugin "nkh/tmuxake"
set -g @plugin "MunifTanjim/tmux-mode-indicator"

# https://github.com/tmux-plugins/tmux-maildir-counter
#set -g @plugin 'tmux-plugins/tmux-maildir-counter'
# set -g @plugin 'charlietag/tmux-split-statusbar'

# =============================================================================
# Session Persistence (MUST be last - continuum depends on resurrect)
# =============================================================================

# Resurrect - manual save/restore
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @resurrect-dir "$HOME/.tmux/resurrect"
set -g @resurrect-save 'C-s'
set -g @resurrect-restore 'C-r'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-processes 'ssh mosh nvim vim vi nano less more man "~npm start" "~yarn start"'

# Continuum - automatic save/restore (MUST be after resurrect)
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'
