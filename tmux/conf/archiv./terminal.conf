# ============================================================================
# TERMINAL CONFIGURATION - WezTerm Optimized
# ============================================================================

# Use tmux-256color for full feature support
set -g default-terminal "tmux-256color"

# ============================================================================
# TRUE COLOR SUPPORT
# ============================================================================
# Force true-color support (Tc = true color)
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",xterm*:Tc"
set -ga terminal-overrides ",wezterm*:Tc"
set -ga terminal-overrides ",alacritty:Tc"
set -ga terminal-overrides ",kitty*:Tc"

# Modern terminal features (requires tmux 3.2+)
set -as terminal-features ",*:RGB"              # True color
set -as terminal-features ",wezterm*:RGB"       # WezTerm specific

# ============================================================================
# WEZTERM SPECIFIC CONFIGURATION
# ============================================================================
# WezTerm clipboard support (OSC 52)
set -ga terminal-overrides ",wezterm*:Ms=\\E]52;c;%p2%s\\7"

# WezTerm extended keys support (critical for Ctrl+number in mux domains)
set -s extended-keys on
set -as terminal-features ",wezterm*:extkeys"

# WezTerm specific features
set -ga terminal-features ",wezterm*:clipboard"
set -ga terminal-features ",wezterm*:ccolour"
set -ga terminal-features ",wezterm*:cstyle"
set -ga terminal-features ",wezterm*:focus"
set -ga terminal-features ",wezterm*:mouse"
set -ga terminal-features ",wezterm*:strikethrough"
set -ga terminal-features ",wezterm*:usstyle"
set -ga terminal-features ",wezterm*:sync"

# Ensure xterm keys work in WezTerm domains
set -g xterm-keys on

# ============================================================================
# TEXT STYLING SUPPORT
# ============================================================================
# Italics support
set -ga terminal-overrides ",*:sitm=\E[3m"      # Start italics
set -ga terminal-overrides ",*:ritm=\E[23m"     # End italics

# Underline styles
set -ga terminal-overrides ",*:smul=\E[4m"      # Start underline
set -ga terminal-overrides ",*:rmul=\E[24m"     # End underline
set -sa terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # Undercurl support

# Enhanced underline colors
set -sa terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Standout mode
set -ga terminal-overrides ",*:smso=\E[7m"      # Start standout
set -ga terminal-overrides ",*:rmso=\E[27m"     # End standout

# Modern text features
set -as terminal-features ",*:usstyle"          # Underscore styles  
set -as terminal-features ",*:overline"         # Overline support
set -as terminal-features ",*:strikethrough"    # Strikethrough
set -as terminal-features ",*:sync"             # Synchronized updates

# ============================================================================
# IMAGE & SIXEL SUPPORT
# ============================================================================
# Enable sixel graphics (for image preview)
set -ga terminal-overrides ",*:sixel"
set -ga terminal-overrides ",wezterm*:sixel"

# Optimize for image rendering
set -g assume-paste-time 1
set -g display-time 4000

# ============================================================================
# SERVER SETTINGS
# ============================================================================
set -s editor "${EDITOR:-nvim}"     # Use your preferred editor
set -s set-clipboard on              # Use OSC 52 for clipboard
set -s escape-time 10                # Fast escape detection (good for vim)
set -s exit-empty on                 # Exit when no active sessions
set -s focus-events on               # Request focus events from terminal
set -s buffer-limit 200              # Number of paste buffers

# ============================================================================
# SESSION & PERFORMANCE SETTINGS
# ============================================================================
# Display settings
set -g display-panes-time 2000

# Activity monitoring
set -g monitor-activity on
set -g visual-activity off

# Bell settings
set -g bell-action none
set -g visual-bell off

# ============================================================================
# ENVIRONMENT UPDATES
# ============================================================================
# Ensure WezTerm pane ID is updated
set -ga update-environment 'WEZTERM_PANE'
set -ga update-environment 'WEZTERM_UNIX_SOCKET'
set -ga update-environment 'TERM'
set -ga update-environment 'TERM_PROGRAM'

# ============================================================================
# KEY ENCODING FIX FOR MUX DOMAINS
# ============================================================================
# This is critical for Ctrl+number combinations in WezTerm mux domains
set -s extended-keys always
set -s user-keys[0] "\e[1;5P"    # Ctrl+F1
set -s user-keys[1] "\e[1;5Q"    # Ctrl+F2
set -s user-keys[2] "\e[1;5R"    # Ctrl+F3
set -s user-keys[3] "\e[1;5S"    # Ctrl+F4

# Map Ctrl+numbers explicitly (helps with mux domain issues)
# These ensure Ctrl+0 through Ctrl+9 work properly
set -s user-keys[10] "\e[48;5u"  # Ctrl+0
set -s user-keys[11] "\e[49;5u"  # Ctrl+1
set -s user-keys[12] "\e[50;5u"  # Ctrl+2
set -s user-keys[13] "\e[51;5u"  # Ctrl+3
set -s user-keys[14] "\e[52;5u"  # Ctrl+4
set -s user-keys[15] "\e[53;5u"  # Ctrl+5
set -s user-keys[16] "\e[54;5u"  # Ctrl+6
set -s user-keys[17] "\e[55;5u"  # Ctrl+7
set -s user-keys[18] "\e[56;5u"  # Ctrl+8
set -s user-keys[19] "\e[57;5u"  # Ctrl+9
