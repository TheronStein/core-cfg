# ============================================================================
# TERMINAL & COLOR CONFIGURATION
# ============================================================================

# Use tmux-256color for full feature support (italics, etc.)
set -g default-terminal "tmux-256color"

# Force true-color support (more comprehensive than basic RGB)
set -ga terminal-features ",*256col*:Tc"        # Force Tc for any 256-color terminfo
set -ga terminal-overrides ",xterm-256color:Tc" # Fallback for older xterm configs  
set -ga terminal-overrides ",xterm*:Tc"         # Catch all xterm variants
# set -ga terminal-overrides ",*:sitm=\E[3m"     # Italics
# set -ga terminal-overrides ",*:ritm=\E[23m"    # Remove italics
# set -ga terminal-overrides ",*:smul=\E[4m"     # Underline
# set -ga terminal-overrides ",*:rmul=\E[24m"    # Remove underline
# set -ga terminal-overrides ",*:smso=\E[7m"     # Standout mode
# set -ga terminal-overrides ",*:rmso=\E[27m"    # Remove standout

# WezTerm specific optimizations
set -ga terminal-overrides ",wezterm*:Tc"
set -ga terminal-overrides ",wezterm*:RGB"
# set -ga terminal-overrides ",wezterm*:sitm=\E[3m"
# set -ga terminal-overrides ",wezterm*:ritm=\E[23m"
# set -ga terminal-overrides ",wezterm*:smul=\E[4m"
# set -ga terminal-overrides ",wezterm*:rmul=\E[24m"

# ============================================================================
# IMAGE PREVIEW SUPPORT
# ============================================================================

# Enable passthrough for modern terminal features (including image protocols)
set -g allow-passthrough on

# Update environment variables when attaching (important for image protocols)
set -ga update-environment 'TERM'
set -ga update-environment 'TERM_PROGRAM'  
set -ga update-environment 'WEZTERM_PANE'

# Optimize for image rendering performance
set -g assume-paste-time 1

# ============================================================================
# SERVER SETTINGS (from reference config)
# ============================================================================

# Modern tmux server configuration
set -s editor         "${EDITOR}"   # Use your preferred editor
set -s set-clipboard  on            # Use escape sequences for clipboard
set -s escape-time    10            # Fast escape detection (good for vim)
set -s exit-empty     on            # Exit when no active sessions
set -s focus-events   on            # Request focus events from terminal
set -s buffer-limit   200           # Number of paste buffers per session

# Enable extended keys (modern terminal support)
# Uncomment if you need extended key sequences:
# set -s extended-keys always

# Ensure tmux advertises xterm keys (compatibility)
set -g xterm-keys on

# ============================================================================
# SESSION & PERFORMANCE SETTINGS
# ============================================================================

# Display messages for longer
set -g display-time 2000
set -g display-panes-time 2000

# Monitor activity but don't be annoying
set -g monitor-activity on
set -g visual-activity off
# Sixel support (your tmux supports basic sixel based on tests)
set -ga terminal-overrides ",*:sixel"
set -ga terminal-overrides ",wezterm*:sixel"

# Optimize for image rendering performance
set -g assume-paste-time 1
set -g display-time 4000 # 1500

# ============================================================================
# MODERN TERMINAL FEATURES
# ============================================================================

# Enable modern terminal features (requires tmux 3.2+)
set -as terminal-features ",*:RGB"              # True color
set -as terminal-features ",*:usstyle"          # Underscore styles  
set -as terminal-features ",*:overline"         # Overline support
set -as terminal-features ",*:strikethrough"    # Strikethrough
set -as terminal-features ",*:sync"             # Synchronized updates

# Enable true color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable sixel support for WezTerm
set -ga terminal-overrides ",wezterm:Tc:Ms=\\E]52;c;%p2%s\\7"

# Allow passthrough for image protocols
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# For sixel support specifically
set -as terminal-features ',wezterm*:sixel'

# Enhanced undercurl and underline styles (from reference config)
set -sa terminal-overrides '*:Smulx=\E[4::%p1%dm'  # Support undercurl
set -sa terminal-overrides '*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # Undercurl colors

# #  backspace             → set key sent by tmux for backspace
# #  exit-unattached       → make server exit if it has no attached clients
# #  history-file          → tmux command history file name
# #  message-limit         → set size of message log per client
# #  prompt-history-limit  → set the number of history items to save in the history file
# #  terminal-features     → set terminal features not detected by terminfo
#
# # set -s  default-terminal   "tmux-256color"         # default terminal definition string
# # set -sa terminal-overrides "xterm-256color:RGB"    # override terminal descriptions
# # set -sa terminal-overrides "alacritty:RGB"         # add truecolor support
# # set -sa terminal-overrides "*:Tc:sitm=\E[3m"         # add truecolor support
# # set -sa terminal-overrides '*:Eneks=\E[>4;1m'
# # set -sa terminal-overrides '*:Dseks=\E[>4;m'
# # set -sa terminal-features 'xterm*:extkeys'
# set -sa terminal-overrides '*:Smulx=\E[4::%p1%dm'  # support undercurl
# set -sa terminal-overrides '*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'
#
#
# # If your TERM already has Tc in terminfo, tmux will pick that up automatically.
# # But in case it doesn’t, force it for any terminfo advertising 256 colors:
# set -ga terminal-features ",*256col*:Tc"
#
# #### 2) Force true-color on any *xterm* (even if terminfo is stale) ####
# # (this is your old xterm-256color:Tc hack, applied *after* the global rule)
# set -ga terminal-overrides ",xterm-256color:Tc"
# set -ga terminal-overrides ",xterm*:Tc"
# # set -s extended-keys  always  # control whether tmux will send extended keys through to the terminal
#
# set -s editor         ${EDITOR}    # specify the command used when tmux runs an editor
# set -s set-clipboard  on           # use esc sequences to set terminal clipboard
# set -s escape-time    10           # set timeout to detect single escape characters (in msecs)
# set -s exit-empty     on           # exit when there are no active sessions
# set -s focus-events   on           # request focus events from terminal
# set -s buffer-limit   200          # number of buffers kept per session
# #
# #Scrollback history ### 1) Default to true-color everywhere tmux can detect it ####
# # Tell tmux to use its own 256-color terminfo (which knows about Tc)
# set -g default-terminal "tmux-256color"
#
# # ensure tmux advertises xterm keys
# set -g xterm-keys on
