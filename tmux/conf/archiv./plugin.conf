# set -g default-path "$MY_PROJECT_DIR"
# if-shell "test -z \"$MY_PROJECT_DIR\"" "set -g default-path /some/default/path"
# ━━━Status Line Plugins━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[[[
# # set -g status-justify 'centre'


# bind M-r run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'
# bind M-s run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'

# Quick save/restore with confirmation
# bind-key 'M-s' confirm-before -p "Save session? (y/n)" "run-shell '${TMUX_PLUGIN_DIR}/tmux-resurrect/scripts/save.sh'"
# bind-key 'M-r' confirm-before -p "Restore session? (y/n)" "run-shell '${TMUX_PLUGIN_DIR}/tmux-resurrect/scripts/restore.sh'"

set -g @plugin-dir "$TMUX_CONF/plugins"
set -g @plugin 'tmux-plugins/tpm'
set -g @tpm-install 'M-i'
set -g @tpm-update 'M-u'
set -g @tpm-clean "M-y"

# Only essential plugins
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @plugin "tmux-plugins/tmux-copycat"
set -g @plugin "tmux-plugins/tmux-prefix-highlight"
set -g @plugin "tmux-plugins/tmux-yank"

#Continuum settings - ENABLE auto-restore
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @contnuum-save-interval '5'
set -g @continuum-boot-options 'wezterm'
set -g @continuum-systemd-start-cmd 'new-session -d'
set -g @resurrect-dir "$TMUX_CONF/resurrect"
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-save-shell-history 'on'
set -g @resurrect-strategy-nvim 'none'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-delete-backup-after '5'

set -g @ressurect-processes '"npm start" env'
set -g @resurrect-hook-post-save-all \
    'eval $(xdotool getwindowgeometry --shell $WINDOWID); \
      echo 0,$X,$Y,$WIDTH,$HEIGHT > $CORECFG/tmux/resurrect/geometry'
set -g @resurrect-hook-pre-restore-all \
    'wmctrl -i -r $WINDOWID -e $(cat $CORECFG/tmux/resurrect/geometry)'

set -g @plugin "arl/gitmux"
set -g @plugin 'tardunge/tmux-gh'
set -g @plugin "MunifTanjim/tmux-mode-indicator"
set -g @plugin "greymd/tmux-xpanes"
# ]]]
#
## ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ]]]
# ━━━FZF━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ [[[
set -g @plugin 'sainnhe/tmux-fzf'
TMUX_FZF_LAUNCH_KEY="f"
TMUX_FZF_OPTIONS="-p -w 80% -h 48% -m"
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ]]]
# ━━━FZF-URLS━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ [[[
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-fzf-options '-w 100% -h 50% --multi -0 --no-preview --no-border'
set -g @fzf-url-fzf-options '-w 100% -h 50% --multi -0 --no-preview --reverse \
                              --color=fg:42,fg+:53,hl:22:bold,hl+:23,bg+:-1 \
                              --color=query:51,info:43:bold,border:33,separator:51,scrollbar:51 \
                              --color=label:27,preview-label:27 \
                              --color=pointer:17,marker:19,spinner:13 \
                              --color=header:12,prompt:18'
set -g @fzf-url-bind 'u'
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ]]]
# == EasyJump =============================================================== [[[
set -g @plugin "roy2220/easyjump.tmux"
set -g @easyjump-key-binding "j"
set -g @easyjump-label-chars "fjdkslaghrueiwoqptyvncmxzb1234567890"
set -g @easyjump-label-attrs "\e[1m\e[38;5;172m"
set -g @easyjump-text-attrs  "\e[0m\e[38;5;237m"
set -g @easyjump-smart-case  "on"
# ]]]

set -g @plugin 'xamut/tmux-spotify'
set -g @plugin "laktak/extrakto"
set -g @plugin "omerxx/tmux-session"
set -g @plugin "nkh/tmuxake"
set -g @plugin "arl/gitmux"
set -g @plugin 'tardunge/tmux-gh'
set -g @plugin "MunifTanjim/tmux-mode-indicator"
set -g @tmux-which-key-xdg-enable 1
set -g @tmux-which-key-xdg-plugin-path "${TMUX_PLUGIN_DIR}/tmux-which-key"
set -g @plugin "alexwforsythe/tmux-which-key"
set -g @plugin 'yardnsm/tmux-1password'
set -g @1password-copy-to-clipboard 'yes'
set -g @1password-key 'F2'

set -g @plugin "Morantron/tmux-fingers"
set -g @plugin "sjdonado/tmux-workspace-usage"
set -g @plugin "jschaf/tmux-newline-detector"

if-shell 'command -v xdg-open >/dev/null 2>&1' "set -g @plugin 'tmux-plugins/tmux-open'" ''
if-shell 'command -v urlview >/dev/null 2>&1' "set -g @plugin 'tmux-plugins/tmux-urlview'" ''
if-shell 'command -v fpp >/dev/null 2>&1' "set -g @plugin 'jbnicolai/tmux-fpp'" ''

# ━━━ Old Plugins━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[[[
#set -g @plugin "cutbypham/tmux-fzf-session-switch"
#set -g @plugin "jabirali/tmux-tilish"
#set -g @plugin "mrjones2014/tmux-which-key"
#set -g @plugin "christoomey/vim-tmux-navigator"
#set -g @plugin "tmux-python/tmuxp"
#set -g @plugin "mrjones2014/tmux-which-key"
#]]]

#Plugins from other dotfiles

# TMUX_PLUGIN_MANAGER_PATH="${TMUX_DATA_DIR}/plugins"
# if '[ ! -d ${TMUX_PLUGIN_MANAGER_PATH}/tpm ]' \
#   'run-shell "git clone --depth 1 https://github.com/tmux-plugins/tpm ${TMUX_PLUGIN_MANAGER_PATH}/tpm"'

# # 5) Bind “R” to the real restore script path
# bind R confirm-before -p "Restore tmux session? (y/n)" \
#     "run-shell '${TMUX_PLUGIN_DIR}/tmux-resurrect/scripts/restore.sh'"

if '[ -f ${TMUX_PLUGIN_MANAGER_PATH}/tmux-newline-detector/scripts/paste.sh ]' \
  'bind -n C-M-down run-shell "${TMUX_PLUGIN_DIR}/tmux-newline-detector/scripts/paste.sh"'

set -g @fingers-key S
set -g @fingers-highlight-format '#[fg=green,bold,dim]%s'
set -g @fingers-hint-format '#[fg=yellow,bold,dim]%s'
# tmux set-environment -g EXEC_PREFIX "DISPLAY=$DISPLAY"
set-environment -g EXEC_PREFIX "DISPLAY=$DISPLAY"
# bind-key -n M-g  run-shell "${TMUX_PLUGIN_DIR}/tmux-fingers/scripts/tmux-fingers.sh"

set -g @fpp-key 'v'

set-environment -g EXEC_PREFIX "DISPLAY=$DISPLAY"

set -g @which-key-config-file "${TMUX_CONF}/which-key-config.yaml"

# fzf menu to kill sessions
bind "k" display-popup -E "\
    tmux list-sessions -F '#{?session_attached,,#{session_name}}' |\
    fzf --reverse -m --header=kill-session |\
    xargs -I {} tmux kill-session -t {}"

set-option -g @fzf-goto-session-only 'true'
set -g @fzf-goto-session 'C-f'
set -g @fzf-goto-win-width 70
set -g @fzf-goto-win-height 20

# set -g @floating_scratch_term 'M-i'
# set -g @floating_scratch_to_active_win 'M-h'
# set -g @floating_scratch_to_win 'M-l'
# set -g @floating_active_pane_to_scratch 'M-m'

set -g @tmux-fzf-launch-key 'M-f'
# set -g @groupings_workspace_directory ~/.ghq

# set -g @vim_navigator_mapping_left "C-Left C-a"  # use C-h and C-Left
# set -g @vim_navigator_mapping_right "C-Right C-d"
# Check and install TPM
# if-shell '[ ! -d "${TMUX_PLUGIN_MANAGER_PATH}" ]' \
#     'run-shell "git clone --depth 1 https://github.com/tmux-plugins/tpm \"${TMUX_PLUGIN_MANAGER_PATH}\""'
#
# # Display status message
# if-shell '[ -d "${TMUX_PLUGIN_MANAGER_PATH}" ]' \
#     'display-message "✅ TPM ready: ${TMUX_PLUGIN_MANAGER_PATH}"' \
#     'display-message "❌ TPM missing: ${TMUX_PLUGIN_MANAGER_PATH}"'

# set -g @vim_navigator_mapping_up "C-w"
# set -g @vim_navigator_mapping_down "C-s"
# set -g @vim_navigator_mapping_prev "C-\\"  # removes the C-\ binding

# # Launchers and scripts
# bind-key Tab display-popup -w 90% -h 90% -E "~/.core/bin/core-wezterm-picker"
# bind-key T display-popup -w 80% -h 80% -E "~/.core/bin/wezterm-theme-browser"
# bind-key s display-popup -w 90% -h 90% -E "~/.core/bin/tmux-session-picker"
# bind -n 'M-/' run-shell "$TMUX_CONF/conf/scripts/popuptmux.sh"
#
# # Session manager
# bind-key M display-popup -w 70% -h 50% -E '~/.core/bin/tmux-session-menu'
