# Yazibar - Keybindings Configuration
# Default keybindings for yazibar module

# Script directory
%hidden YAZIBAR_SCRIPTS="$HOME/.core/cfg/tmux/modules/yazibar/scripts"

# ============================================================================
# LEFT SIDEBAR (File Navigation)
# ============================================================================

# Toggle left sidebar
bind -n M-f run-shell "$YAZIBAR_SCRIPTS/yazibar-left.sh toggle"

# Focus left sidebar (create if doesn't exist)
bind -n M-g run-shell "$YAZIBAR_SCRIPTS/yazibar-left.sh focus"

# Resize left sidebar wider
bind -n M-BSpace run-shell "bash -c '\
    window_id=\$(tmux display-message -p \"#{window_id}\"); \
    pane_id=\$(tmux show-option -gqv \"@yazibar-left-pane-id-\${window_id}\"); \
    width=\$(tmux display-message -p -t \"\$pane_id\" \"#{pane_width}\"); \
    new_width=\$((width + 5)); \
    $YAZIBAR_SCRIPTS/yazibar-left.sh resize \$new_width'"

# Resize left sidebar narrower
bind -n M-\\ run-shell "bash -c '\
    window_id=\$(tmux display-message -p \"#{window_id}\"); \
    pane_id=\$(tmux show-option -gqv \"@yazibar-left-pane-id-\${window_id}\"); \
    width=\$(tmux display-message -p -t \"\$pane_id\" \"#{pane_width}\"); \
    new_width=\$((width - 5)); \
    $YAZIBAR_SCRIPTS/yazibar-left.sh resize \$new_width'"

# ============================================================================
# RIGHT SIDEBAR (Preview)
# ============================================================================

# Toggle right sidebar
bind -n M-F run-shell "$YAZIBAR_SCRIPTS/yazibar-right.sh toggle"

# Focus right sidebar (create if doesn't exist)
bind -n M-G run-shell "$YAZIBAR_SCRIPTS/yazibar-right.sh focus"

# Resize right sidebar wider
bind -n M-] run-shell "bash -c '\
    window_id=\$(tmux display-message -p \"#{window_id}\"); \
    pane_id=\$(tmux show-option -gqv \"@yazibar-right-pane-id-\${window_id}\"); \
    width=\$(tmux display-message -p -t \"\$pane_id\" \"#{pane_width}\"); \
    new_width=\$((width + 5)); \
    $YAZIBAR_SCRIPTS/yazibar-right.sh resize \$new_width'"

# Resize right sidebar narrower
bind -n M-[ run-shell "bash -c '\
    window_id=\$(tmux display-message -p \"#{window_id}\"); \
    pane_id=\$(tmux show-option -gqv \"@yazibar-right-pane-id-\${window_id}\"); \
    width=\$(tmux display-message -p -t \"\$pane_id\" \"#{pane_width}\"); \
    new_width=\$((width - 5)); \
    $YAZIBAR_SCRIPTS/yazibar-right.sh resize \$new_width'"

# ============================================================================
# SYNCHRONIZATION
# ============================================================================

# Toggle input synchronization
bind -n M-S run-shell "$YAZIBAR_SCRIPTS/yazibar-sync.sh toggle"

# ============================================================================
# SESSION MANAGEMENT
# ============================================================================

# Show yazibar status
bind -n M-? run-shell "tmux display-popup -E -w 80% -h 60% '\
    echo \"=== YAZIBAR STATUS ===\";\
    echo \"\";\
    $YAZIBAR_SCRIPTS/yazibar-left.sh status;\
    echo \"\";\
    $YAZIBAR_SCRIPTS/yazibar-right.sh status;\
    echo \"\";\
    $YAZIBAR_SCRIPTS/yazibar-session-manager.sh status;\
    echo \"\";\
    $YAZIBAR_SCRIPTS/yazibar-width.sh list;\
    echo \"\";\
    read -p \"Press Enter to close...\"'"

# Cleanup yazibar sessions
bind -n M-C-c run-shell "$YAZIBAR_SCRIPTS/yazibar-session-manager.sh cleanup"

# ============================================================================
# NVIM INTEGRATION
# ============================================================================

# Register current nvim instance
# bind -n M-n run-shell "$YAZIBAR_SCRIPTS/yazibar-nvim.sh register"

# Show nvim status
bind -n M-N run-shell "tmux display-popup -E -w 60% -h 40% '\
    $YAZIBAR_SCRIPTS/yazibar-nvim.sh status;\
    echo \"\";\
    read -p \"Press Enter to close...\"'"

# ============================================================================
# RCLONE BROWSER
# ============================================================================

# Toggle rclone browser (left sidebar: browser, right sidebar: preview)
bind -n M-r run-shell "$HOME/.core/cfg/tmux/modules/browsers/rclone-browser/toggle-rclone-browser.sh toggle"

# Focus rclone browser (left pane)
bind -n M-R run-shell "$HOME/.core/cfg/tmux/modules/browsers/rclone-browser/toggle-rclone-browser.sh focus-left"
